---
title: "Project"
author: "Winston"
date: "November 9, 2014"
output: pdf_document
---

###Executive Summary

This analysis looks at the energy efficiency (~ mpg) of cars in the Motor Trend data set and the factors affecting it. Particularly, it addresses the hyptohesis that manual transmissions are more efficient (have higher mpg) than automatic transmissions. 

To address this, the analysis takes the approach of linearizing the "physics" by looking at the affects of confounding variables like horsepower (hp) and vehicle weight (wt) on gallons per mile. 

###exploratory data analysis

```{r}
data(mtcars)
library(plyr)

mtcars2=mutate(mtcars, gpm=1/mpg)

pairs(mpg~disp+am+wt,data=mtcars, 
   main="Exploratory Analysis")

```
  

There are data for `r nrow(mtcars)` different cars in the data set.  
The data present are _`r colnames(mtcars)`_.  

mpg	Miles/(US) gallon
cyl	Number of cylinders
disp	Displacement (cu.in.)
hp	Gross horsepower
drat	Rear axle ratio
wt	Weight (lb/1000)
qsec	1/4 mile time
vs	V/S
am	Transmission (0 = automatic, 1 = manual)
gear	Number of forward gears
carb	Number of carburetors

The exploratory analysis shows there are multiple dependencies. To understand how transmission type affects mpg we need account for these other factors. 


As you can see from the graph, displacement and horsepower tend to follow weigth. So we'll focus on correcting for the weight factor in mpg and look at residual.

##linear Model with weight as predictor is insufficient


```{r}
library(plyr)
library(ggplot2)
data(mtcars)

p1<-ggplot(mtcars, aes(wt, mpg, color=factor(am))) + geom_point(size=3)
p1<-p1+ggtitle("mpg versus weight")
p1<-p1+labs(x="weight (1000's of lbs)", y="miles per gallon")
#p1<-p1+geom_smooth(method=lm)


f1<-lm(mpg~ wt, data=mtcars)
int<-coef(f1)[1]
slp<-coef(f1)[2]


p1<-p1+geom_abline(intercept=int, slope=slp)
p1


```


In the above graph the fitted line does not go an adequate job of accounting for about `r 100*summary(f1)$r.squared`% of the overall variation. It is easily recognized that there are systematic variations tht are un accounted for by looking at a residual plot of the data for automatic and manual transmissions.


```{r}



rmpg<-residuals(f1)
resid<-as.data.frame(rmpg)

resid$rmpg

mtcars1<-cbind(mtcars, resid$rmpg)

head(mtcars1)

p<-ggplot(mtcars1, aes(wt, resid$rmpg, color=factor(am))) + geom_point(size=3)
p<-p+ggtitle("Residuals mpg versus weight")
p<-p+labs(x="weight (1000's of lbs)", y="residuals")
p<-p+geom_smooth(method=lm,se=TRUE)
p

```
 

##a linear model wiht confounding variables

To fit the data try a functional relationship _mpg~ a + b/wt_ with a and b constants to be determined. The graph below shows the fit. 

```{r}
library(plyr)
library(ggplot2)
data(mtcars)


mtcars2=mutate(mtcars1, invwt=1/wt)
mtcars2=mutate(mtcars2, invdisp=1/disp)

p1<-ggplot(mtcars2, aes(invwt, mpg, color=factor(am))) + geom_point(size=3)
p1<-p1+ggtitle("mpg versus 1/weight")
p1<-p1+labs(x="1/weight (1/1000's of lbs)", y="miles per gallon")
#p1<-p1+geom_smooth(method=lm)


f2<-lm(mpg~ invwt + invdisp, data=mtcars2)
int<-coef(f2)[1]
slp<-coef(f2)[2]


p1<-p1+geom_abline(intercept=int, slope=slp)
p1


```


```{r}


carnls <- nls(mpg~a1 + b1/hp, mtcars, start = list(a1=1, b1=50))


carnls

ss<-seq(from = min(mtcars$hp), to = max(mtcars$hp), length = 50)


plot(jitter(mpg,4)~hp, data=mtcars, pch=19, col="slateblue2", xlab="horsepower", ylab="mpg")


yy <- predict(carnls,list(hp = ss))

lines(ss, yy, col = "orange4", lwd=3)

```

###Model Residuals

```{r}

mpgpredict<-predict(carnls)

plot((mpg-mpgpredict)~hp, data=mtcars)

hist(mtcars$mpg-mpgpredict, breaks=18, col="wheat3", xlab="mpg residual", main="Histogram of mpg residuals")

residuals(carnls)

```


```{r}
library(plyr)

mpgresids <- mtcars$mpg-mpgpredict

mtcars2<-cbind(mtcars, mpgresids)

p<-ggplot(mtcars2, aes(wt, mpgresids, color=factor(am))) + geom_point()

p

p<-ggplot(mtcars, aes(hp, wt, color=factor(am))) + geom_point()

p

```


```{r}
library(plyr)

## calculate residuals ad bind to mtcars to do some plotting

mpgresids <- mtcars$mpg-mpgpredict

mtcars2<-cbind(mtcars, mpgresids)

p<-ggplot(mtcars2, aes(wt, mpgresids, color=factor(am))) + geom_point()

p

p<-ggplot(mtcars, aes(wt, mpg, color=factor(am))) + geom_point()

p

```


```{r}
##here we do statistics on the residuals


autoresids <- mtcars2[mtcars$am==0,]
manresids <- mtcars2[mtcars$am==1,]

meanautoresids<-mean(autoresids$mpgresids)
sdautoresids<-sd(autoresids$mpgresids)
nautoresids <- nrow(autoresids)

meanmanresids<-mean(manresids$mpgresids)
sdmanresids<-sd(manresids$mpgresids)
nmanresids <- nrow(manresids)


aaa<-t.test(autoresids$mpgresids, manresids$mpgresids, alternative="less")
pv<-aaa$p.value
lc<-aaa$conf.int[1]
uc<-aaa$conf.int[2]
